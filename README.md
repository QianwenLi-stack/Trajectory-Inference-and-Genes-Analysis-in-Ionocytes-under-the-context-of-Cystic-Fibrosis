# Trajectory-Inference-and-Genes-Analysis-in-Ionocytes-under-the-context-of-Cystic-Fibrosis

## Introduction
Many interesting biological processes could demonstrate itself as a continuum of dynamic cellular states. In  Part 1 and Part 2, we mainly focused on analyzing the clustered ionocytes and their subtypes, which are static snapshots of discrete cellular states and could not reveal temporal changes in gene expression underlying dynamic biological processes such as cell differentiation and disease progression. In this module, I will perform pseudotime analysis to study the dynamic properties of human airway epithelial cells, with a focus on ionocytes and their subtypes. By analyzing their differential expressed genes with respect to pseudotime and the enriched pathways, the main goal here is to explore potential ionocyte cell state transitions that might be associated with cystic fibrosis, providing insight into potential therapeutic targets.

## Data and methods
### Data: Clustered human airway epithelium single cell data from normal and cystic fibrosis lungs
The source data comes from a multi-institute consortium studying human airway epithelium at the single-cell level, encompassing 19 donors with cystic fibrosis undergoing transplantation for end-stage lung disease and 19 donors with previously healthy lungs. The preprocessed data after quality control, expression normalization, and batch effect correction was downloaded from GEO database in the format of rds (data/GSE150674_Seurat_Object_ALI.rds) using accession number GSE150674 [1]. The data contains 3000 genes and 10706 cells. In previous analysis modules, five clusters were identified, with cluster 4 being identified as ionocytes (n =121, CF:CO=58:63). Further clustering analysis in the ionocytes found 2 subtypes, with 74 cells belonging to subtype 0 (CF:CO= 39 :35) and 47 cells belonging to subtype 1 (CF:CO=28:19). I will start from the clustered data for all cells (data/GEO1ClusterSeurat.rds) and clustered ionocytes data (data/ClusteredIono.rds) to perform trajectory analysis in terms of airway epithelial cells, ionocytes, and ionocyte subtypes.

### Method: Trajectory inference with Slingshot 2.10.0
Trajectory inference or pseudotemporal ordering is a computational method to study cells that change their states by undergoing gradual transcriptional changes, with progress being driven by an underlying temporal variable or pseudotime.  I used an R package named “Slingshot”, which is an unsupervised learning method that can stably reconstruct the pseudo-temporal order by first inferring global lineage structure with cluster-based minimum spanning tree and then inferring pseudotime variables for cells along each lineage with simultaneous principal curves [12]. I used Slingshot to perform trajectory inferences using the clustered results based on t-SNE in three levels:  all cells, ionocytes and ionocyte subtypes (Fig 3A, Fig 3B, Fig 3E & Fig 3F). To explore the potential relationship between dynamic cell states and Cystic Fibrosis disease, I performed the nonparametric two-sample Kolmogorov-Simrnov test to quantitatively evaluate whether there is a significant difference between the distribution of CF vs CO along the trajectory. 

### Method: Trajectory differential genes analysis with TSCAN 1.40.1
I used the testPseudotime function in the R package TSCAN to detect differentially expressed genes given a constructed pseudo time ordering by fitting a natural spline and using ANOVA to test whether any of the spline coefficients are non-zero [13]. Using a false discovery rate of 0.05 and an absolute log fold change of 0.05 (suggested by the paper), I found 93 differentially expressed genes in the ionocyte trajectory (data/Ionocyte_Trajectory_genes.csv), 60 differentially expressed genes in the ionocyte subtype 0 trajectory (data/Ionocyte_Trajectory_s0_genes.csv), and 136 differentially expressed genes in ionocyte subtype 1 trajectory respectively (data/Ionocyte_Trajectory_s1_genes.csv). The expression of these genes along the estimated pseudotime in ionocytes, ionocyte subtype 0 and ionocyte subtype 1 is visualized as heat maps respectively (Fig 3D, Fig 3G && Fig 3H).

### Method: Trajectory gene set enrichment analysis with fgsea 1.28.0 
To interpret the biological functions of the trajectory differentially expressed genes, I performed gene set enrichment analysis using the R package fgsea [14]. I ranked all the genes using the metric sign(log2 fold change)*(-log10 p value), in which the magnitude of the ranking will be given by the p-value, and the sign of the ranking will be given by the fold-change. The background I used comes from the Molecular Signatures Database (MSigDB) [15]. I used human biological pathway (BP) subcollection in the C5 collection (ontology gene sets) to perform enrichment analysis for differentially expressed genes in ionocyte trajectory and ionocyte subtypes trajectory, with the  background genes filtered to the same 3000 genes as our data. Using FDR<0.05, no statistically significant enriched pathways are found for trajectory genes in ionocyte subtypes. The enriched pathway for overall ionocyte trajectory genes are shown in Fig 3C.


### Results and discussion
From the global trajectory reconstruction results using all human airway cells in our dataset (Fig 3A), we can see two estimated lineages. Both estimated lineage trajectories demonstrated a continuous trajectory along Cluster 3-Cluster 1-Cluster 0. The first lineage then connects Cluster 2, while the second lineage then traverses through Cluster 4, which is the ionocyte cluster of our interest. Based on the cell type annotation (Cluster 0: Basal cells, Cluster 1: Basal cells, Cluster 2: Secretory cells), it is likely that the shared trajectory recapitulates the known basal-to-secretory cell lineage, in which basal cells are a recognized stem cell population in both human and mouse lungs [16]. This finding holds significant promise for informing ionocyte cell therapy proposed recently for cystic fibrosis [17], as it delineates a potential differentiation path towards ionocytes.
Focusing on the trajectory of ionocyte and its two subtypes, one interesting finding is that CF and CO ionocyte in subtype 0 shows statistically significant distribution over the estimated pseudo time (two-sample Kolmogorov-Simrnov test, D=0.44, p-value = 8.86e-4), which might indicate potential relationship between cell state transition and CF in ionocyte subtype 0 (Fig 3G). The reasonability of this finding is further supported when we look at the differential genes (data/Ionocyte_Trajectory_s0_genes.csv). For example, the differentially expressed genes CLCNKB (logFC=-0.12, FDR=0.0056), CLIC6 (logFC=0.06, FDR=6.4e-10) are related to chloride channels, which is important for maintaining chloride ion balance [18], and abnormal chloride balance could related to cystic fibrosis. Besides, other differentially expressed genes such as SCGB3A1 (logFC=0.13, FDR=1.35e-10) and PIGR (logFC=0.06,FDR=6.26e-8) are related to airway epithelial immune regulation [18], and previous researches has indicated potential roles of immunity with cystic fibrosis [19]. However, no statistical significant enrichment of pathways is found for these genes.
There are enriched pathways for differentially expressed genes along the pseudo time in the overall ionocytes trajectory. From Fig 3D, we could observe 3 clustered expression patterns of these genes along the estimated pseudotime . Based on the gene set enrichment analysis, one interesting finding is that ion homeostasis and ion transmembrane transport are identified as enriched pathways (Fig 3C), suggesting a transition of cell states regarding ion-regulation in ionocytes. This could be important since cystitis fibrosis is associated with abnormal ion regulation, and ionocyte is a potential target for therapeutic intervention. Understanding this cell state transition could offer us insight into critical time points for therapeutics target.
Overall, this part mainly discussed the potential cell state transition in ionocytes, and providing potential insight for the pathology and therapy for cystic fibrosis. Instead of focusing on single causal genes such as CFTR in ionocytes, context-based cell state might also affect cystic fibrosis, which could be a potential reason why CFTR gene expression alone is not enough to explain the cystitis fibrosis.



